version: '3'
services:
  postgres:
    image: daafonsecato/kataterm-postgres:latest
    build:
      context: ./database
      dockerfile: Dockerfile
    ports:
      - "5432:5432"
    environment:
      POSTGRES_USER: your_username
      POSTGRES_PASSWORD: your_password
      POSTGRES_DB: your_database_name
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./database/scripts/init.sql:/docker-entrypoint-initdb.d/init.sql
    networks:
      - quizard_network

  frontend:
    image: daafonsecato/kataterm-frontend:latest
    build:
      context: ./frontend
      dockerfile: Dockerfile.develop
    ports:
      - 80:3000
    volumes:
      - ./frontend:/app
    environment:
      - NODE_ENV=development
    env_file:
      - ./frontend/.env
    networks:
      - quizard_network

  backend:
    image: daafonsecato/kataterm-backend:latest
    build:
      context: ./backend
      dockerfile: Dockerfile.develop
    ports:
      - 8000:8000
    env_file:
      - ./backend/.env
    depends_on:
      - postgres
    volumes:
      - ./backend:/app
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - NODE_ENV=development
    networks:
      - quizard_network
    privileged: true  

  reverseproxy:
    image: daafonsecato/kataterm-reverseproxy:latest
    build:
      context: ./reverseproxy
      dockerfile: Dockerfile
    ports:
      - 7070:7070
      - 9090:9090
    env_file:
      - ./reverseproxy/.env
    depends_on:
      - postgres
    volumes:
      - ./reverseproxy:/app
      - /home/ubuntu/.aws/credentials:/root/.aws/credentials
    networks:
      - quizard_network

  gitkatas:
    image: daafonsecato/kataterm-gitkatas:latest
    build:
      context: ./ch1-git-katas
      dockerfile: Dockerfile.gitkatas
    ports:
      - 7681:7681
      - 8080:8080
    volumes:
      - ./ch1-git-katas/exercise:/home/git-katas-user/exercise
    networks:
      - quizard_network

  validator:
    image: daafonsecato/kataterm-validator:latest
    build:
      context: ./ch1-git-katas
      dockerfile: Dockerfile.validator
    volumes:
      - ./ch1-git-katas/validation:/validation
      - ./ch1-git-katas/exercise:/exercise
    networks:
      - quizard_network

networks:
  quizard_network:
    driver: bridge

volumes:
  postgres_data:

